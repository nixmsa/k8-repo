37. Create 5 nginx pods in which two of them is labeled env=prod and three of them is labeled env=dev
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl run nginx-dev1 --image=nginx --labels=env=dev --restart=Never
pod/nginx-dev1 created
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl run nginx-dev2 --image=nginx --labels=env=dev --restart=Never
pod/nginx-dev2 created
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl run nginx-dev3 --image=nginx --labels=env=dev --restart=Never
pod/nginx-dev3 created
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl run nginx-dev1 --image=nginx --labels=env=dev --restart=Never
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl run nginx-prod1 --image=nginx --labels=env=prod --restart=Never
pod/nginx-prod1 created
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl run nginx-prod2 --image=nginx --labels=env=prod --restart=Never


####

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pods --show-labels;
NAME                       READY   STATUS      RESTARTS   AGE     LABELS
busybox                    0/1     Completed   0          6d8h    run=busybox
busybox-sleep-3600         0/1     Error       0          6d7h    run=busybox-sleep-3600
nginx                      0/1     Error       2          6d9h    run=nginx
nginx-dev1                 1/1     Running     0          5m32s   env=dev
nginx-dev2                 1/1     Running     0          5m26s   env=dev
nginx-dev3                 1/1     Running     0          5m20s   env=dev
nginx-prod1                1/1     Running     0          4m39s   env=prod
nginx-prod2                1/1     Running     0          4m33s   env=prod
nginx01-67fdf8d7c7-4nd29   1/1     Running     2          6d12h   app=nginx01,pod-template-hash=67fdf8d7c7
nginx02                    0/1     Error       0          6d11h   run=nginx02
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pods -l env=dev
NAME         READY   STATUS    RESTARTS   AGE
nginx-dev1   1/1     Running   0          6m58s
nginx-dev2   1/1     Running   0          6m52s
nginx-dev3   1/1     Running   0          6m46s
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pods -l env=dev --show-labels;
NAME         READY   STATUS    RESTARTS   AGE     LABELS
nginx-dev1   1/1     Running   0          7m15s   env=dev
nginx-dev2   1/1     Running   0          7m9s    env=dev
nginx-dev3   1/1     Running   0          7m3s    env=dev
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pods -L env
NAME                       READY   STATUS      RESTARTS   AGE     ENV
busybox                    0/1     Completed   0          6d8h
busybox-sleep-3600         0/1     Error       0          6d7h
nginx                      0/1     Error       2          6d9h
nginx-dev1                 1/1     Running     0          8m1s    dev
nginx-dev2                 1/1     Running     0          7m55s   dev
nginx-dev3                 1/1     Running     0          7m49s   dev
nginx-prod1                1/1     Running     0          7m8s    prod
nginx-prod2                1/1     Running     0          7m2s    prod
nginx01-67fdf8d7c7-4nd29   1/1     Running     2          6d12h
nginx02                    0/1     Error       0          6d11h
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$


mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pods -l 'env in (dev,prod)'
NAME          READY   STATUS    RESTARTS   AGE
nginx-dev1    1/1     Running   0          2m41s
nginx-dev2    1/1     Running   0          2m41s
nginx-dev3    1/1     Running   0          2m39s
nginx-prod1   1/1     Running   0          2m26s
nginx-prod2   1/1     Running   0          2m16s

46. Change the label for one of the pod to env=uat and list all the pods to verify

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl label pod/nginx-dev3 env=uat --overwrite
pod/nginx-dev3 labeled
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pod --show-labels;
NAME          READY   STATUS    RESTARTS   AGE     LABELS
nginx-dev1    1/1     Running   0          7m44s   env=dev
nginx-dev2    1/1     Running   0          7m44s   env=dev
nginx-dev3    1/1     Running   0          7m42s   env=uat
nginx-prod1   1/1     Running   0          7m29s   env=prod
nginx-prod2   1/1     Running   0          7m19s   env=prod

47. Remove the labels for the pods that we created now and verify all the labels are removed

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl label pod nginx-dev{1..3} env-
pod/nginx-dev1 labeled
pod/nginx-dev2 labeled
pod/nginx-dev3 labeled
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl label pod nginx-pod{1..2} env-
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl label pod nginx-prod{1..2} env-
pod/nginx-prod1 labeled
pod/nginx-prod2 labeled
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get po --show-labels;
NAME          READY   STATUS    RESTARTS   AGE   LABELS
nginx-dev1    1/1     Running   0          11m   <none>
nginx-dev2    1/1     Running   0          11m   <none>
nginx-dev3    1/1     Running   0          11m   <none>
nginx-prod1   1/1     Running   0          11m   <none>
nginx-prod2   1/1     Running   0          11m   <none>
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$

48. Letâ€™s add the label app=nginx for all the pods and verify

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl label pod nginx-dev{1..3} env=nginx-dev
pod/nginx-dev1 labeled
pod/nginx-dev2 labeled
pod/nginx-dev3 labeled
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl label pod nginx-prod{1..3} env=nginx-prod
pod/nginx-prod1 labeled
pod/nginx-prod2 labeled


mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pod --show-labels
NAME          READY   STATUS    RESTARTS   AGE   LABELS
nginx-dev1    1/1     Running   0          19m   env=nginx-dev
nginx-dev2    1/1     Running   0          19m   env=nginx-dev
nginx-dev3    1/1     Running   0          19m   env=nginx-dev
nginx-prod1   1/1     Running   0          19m   env=nginx-prod
nginx-prod2   1/1     Running   0          18m   env=nginx-prod

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl label node k8s-node-0.example.com nodeName=nginxnode
node/k8s-node-0.example.com labeled
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get node
NAME                     STATUS   ROLES    AGE   VERSION
k8s-master.example.com   Ready    master   70d   v1.18.6
k8s-node-0.example.com   Ready    <none>   70d   v1.19.1
k8s-node-1.example.com   Ready    <none>   70d   v1.19.1
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get node --show-labels
NAME                     STATUS   ROLES    AGE   VERSION   LABELS
k8s-master.example.com   Ready    master   70d   v1.18.6   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-master.example.com,kubernetes.io/os=linux,node-role.kubernetes.io/master=
k8s-node-0.example.com   Ready    <none>   70d   v1.19.1   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node-0.example.com,kubernetes.io/os=linux,nodeName=nginxnode
k8s-node-1.example.com   Ready    <none>   70d   v1.19.1   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node-1.example.com,kubernetes.io/os=linux
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$

51. Create a Pod that will be deployed on this node with the label nodeName=nginxnode

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl run nginx --image=nginx --restart=Never --dry-run -o yaml > pod.yaml
W0927 17:39:16.323685   69471 helpers.go:535] --dry-run is deprecated and can be replaced with --dry-run=client.

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ vim pod.yaml
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl create -f pod.yaml
pod/nginx created
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pods -o wide
NAME          READY   STATUS    RESTARTS   AGE   IP               NODE                     NOMINATED NODE   READINESS GATES
nginx         1/1     Running   0          10s   172.16.182.48    k8s-node-0.example.com   <none>           <none>
nginx-dev1    1/1     Running   0          60m   172.16.122.105   k8s-node-1.example.com   <none>           <none>
nginx-dev2    1/1     Running   0          60m   172.16.182.46    k8s-node-0.example.com   <none>           <none>
nginx-dev3    1/1     Running   0          60m   172.16.122.106   k8s-node-1.example.com   <none>           <none>
nginx-prod1   1/1     Running   0          60m   172.16.122.107   k8s-node-1.example.com   <none>           <none>
nginx-prod2   1/1     Running   0          60m   172.16.182.47    k8s-node-0.example.com   <none>           <none>
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ cat pod.yaml
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: nginx
  name: nginx
spec:
  nodeSelector:
          nodeName: nginxnode
  containers:
  - image: nginx
    name: nginx
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Never
status: {}


mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl describe po nginx | grep Node-Selector
Node-Selectors:  nodeName=nginxnode



54. Annotate the pods with name=webapp


mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl annotate pod nginx-dev{1..3} name=webapp
pod/nginx-dev1 annotated
pod/nginx-dev2 annotated
pod/nginx-dev3 annotated
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl annotate pod nginx-prod{1..2} name=webapp
pod/nginx-prod1 annotated
pod/nginx-prod2 annotated
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl get pods --show-labels;
NAME          READY   STATUS    RESTARTS   AGE    LABELS
nginx         1/1     Running   0          40m    run=nginx
nginx-dev1    1/1     Running   0          101m   env=nginx-dev
nginx-dev2    1/1     Running   0          101m   env=nginx-dev
nginx-dev3    1/1     Running   0          101m   env=nginx-dev
nginx-prod1   1/1     Running   0          101m   env=nginx-prod
nginx-prod2   1/1     Running   0          100m   env=nginx-prod
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl describe pod nginx-dev{1..3} | grep -i annotations
Annotations:  cni.projectcalico.org/podIP: 172.16.122.105/32
Annotations:  cni.projectcalico.org/podIP: 172.16.182.46/32
Annotations:  cni.projectcalico.org/podIP: 172.16.122.106/32
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl describe pod nginx-prod{1..2} | grep -i annotations
Annotations:  cni.projectcalico.org/podIP: 172.16.122.107/32
Annotations:  cni.projectcalico.org/podIP: 172.16.182.47/32


mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl describe pod nginx-dev1
Name:         nginx-dev1
Namespace:    default
Priority:     0
Node:         k8s-node-1.example.com/192.168.0.42
Start Time:   Sun, 27 Sep 2020 16:40:48 +0000
Labels:       env=nginx-dev
Annotations:  cni.projectcalico.org/podIP: 172.16.122.105/32
              cni.projectcalico.org/podIPs: 172.16.122.105/32
              name: webapp
Status:       Running
IP:           172.16.122.105
IPs:
  IP:  172.16.122.105
Containers:

mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl describe pod nginx-dev1 | grep -A 5 Annotations
Annotations:  cni.projectcalico.org/podIP: 172.16.122.105/32
              cni.projectcalico.org/podIPs: 172.16.122.105/32
              name: webapp
Status:       Running
IP:           172.16.122.105
IPs:

56. Remove the annotations on the pods and verify


mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl describe pod nginx-dev{1..3} | grep -A 6 Annotations
Annotations:  cni.projectcalico.org/podIP: 172.16.122.105/32
              cni.projectcalico.org/podIPs: 172.16.122.105/32
Status:       Running
IP:           172.16.122.105
IPs:
  IP:  172.16.122.105
Containers:
--
Annotations:  cni.projectcalico.org/podIP: 172.16.182.46/32
              cni.projectcalico.org/podIPs: 172.16.182.46/32
Status:       Running
IP:           172.16.182.46
IPs:
  IP:  172.16.182.46
Containers:
--
Annotations:  cni.projectcalico.org/podIP: 172.16.122.106/32
              cni.projectcalico.org/podIPs: 172.16.122.106/32
Status:       Running
IP:           172.16.122.106
IPs:
  IP:  172.16.122.106
Containers:
mahsan@k8s-master:~/projects/k8-repo/k8-repo/k8-repo/techcode/projects/ckad/Q-ckad/Pod-Design$ kubectl describe pod nginx-prod{1..2} | grep -A 6 Annotations
Annotations:  cni.projectcalico.org/podIP: 172.16.122.107/32
              cni.projectcalico.org/podIPs: 172.16.122.107/32
              name: webapp
Status:       Running
IP:           172.16.122.107
IPs:
  IP:  172.16.122.107
--
Annotations:  cni.projectcalico.org/podIP: 172.16.182.47/32
              cni.projectcalico.org/podIPs: 172.16.182.47/32
              name: webapp
Status:       Running
IP:           172.16.182.47
IPs:
  IP:  172.16.182.47


